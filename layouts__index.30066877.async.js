"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[717],{8722:function(V,x,v){v.r(x),v.d(x,{default:function(){return F}});var O=v(36044),H=v(88023),u=v(75271),T=v(34464),I=v(15558),y=v.n(I),L=v(48305),R=v.n(L);function M(){var l=(0,T.useSelectedRoutes)(),d=(0,T.useOutlet)(),r=(0,T.useAppData)(),f=r.routes,b=(0,T.useLocation)(),m=b.pathname,a=(0,T.useIntl)(),S=a.formatMessage,h=(0,u.useState)(),s=R()(h,2),o=s[0],E=s[1],k=function(c){for(var i=c.route,t=["menu"];i.parentId&&!i.isLayout&&f[i.parentId].name;){t.push(f[i.parentId].name);i=f[i.parentId]}return t.push(c.route.name),S({id:t.join(".")})};return(0,u.useEffect)(function(){var P,c=l.at(-1);if(c!=null&&(P=c.route)!==null&&P!==void 0&&P.path){var i=f[c.route.id];if(i!=null&&i.redirect){T.history.replace(i==null?void 0:i.redirect);return}var t=k(c);E({title:t,pathname:m,children:d,routePath:c.route.path,icon:c.route.icon})}},[m]),o}function A(){return new Date().getTime().toString()}function K(){var l=(0,u.useState)([]),d=R()(l,2),r=d[0],f=d[1],b=(0,u.useState)(""),m=R()(b,2),a=m[0],S=m[1],h=(0,u.useRef)({}),s=(0,u.useRef)({}),o=M(),E=(0,u.useCallback)(function(t){h.current[a]||(h.current[a]=[]),h.current[a].push(t)},[a]),k=(0,u.useCallback)(function(t){s.current[a]||(s.current[a]=[]),s.current[a].push(t)},[a]),P=(0,u.useCallback)(function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:a,e=r.findIndex(function(n){return n.routePath===t});r[e].routePath===a&&(e>0?T.history.push(r[e-1].routePath):T.history.push(r[e+1].routePath)),r.splice(e,1),delete s.current[t],delete h.current[t],f(y()(r))},[a]),c=(0,u.useCallback)(function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:a,e=r.filter(function(n){return n.routePath!==t});e.forEach(function(n){delete s.current[n.routePath],delete h.current[n.routePath]}),f(function(n){return n.filter(function(g){return g.routePath===t})})},[a]),i=(0,u.useCallback)(function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:a;f(function(e){var n=e.findIndex(function(g){return g.routePath===t});return n>=0&&(e[n].key=A()),delete s.current[e[n].routePath],delete h.current[e[n].routePath],y()(e)})},[a]);return(0,u.useEffect)(function(){if(o){var t=r.find(function(e){return e.routePath===(o==null?void 0:o.routePath)});S(o.routePath),t?t.pathname!==o.pathname?f(function(e){var n=e.findIndex(function(g){return g.routePath===o.routePath});return n>=0&&(e[n].key=A(),e[n].pathname=o.pathname,e[n].children=o.children),delete s.current[e[n].routePath],delete h.current[e[n].routePath],y()(e)}):(h.current[t.routePath]||[]).forEach(function(e){e()}):f(function(e){return[].concat(y()(e),[{title:o.title,key:A(),routePath:o.routePath,pathname:o.pathname,children:o.children,icon:o.icon}])}),(s.current[a]||[]).forEach(function(e){e()})}},[o]),{keepAliveTabs:r,activeTabRoutePath:a,closeTab:P,refreshTab:i,closeOtherTab:c,onShow:E,onHidden:k}}var j={refreshTab:function(){},closeTab:function(){},closeOtherTab:function(){},onShow:function(){},onHidden:function(){}},D=(0,u.createContext)(j),C=v(52676),p=function(l){return l.REFRESH="refresh",l.CLOSE="close",l.CLOSEOTHER="close-other",l}(p||{}),w=function(){var d=K(),r=d.keepAliveTabs,f=d.activeTabRoutePath,b=d.closeTab,m=d.refreshTab,a=d.closeOtherTab,S=d.onHidden,h=d.onShow,s=(0,u.useMemo)(function(){return[{label:"\u5237\u65B0",key:p.REFRESH},r.length<=1?null:{label:"\u5173\u95ED",key:p.CLOSE},r.length<=1?null:{label:"\u5173\u95ED\u5176\u4ED6",key:p.CLOSEOTHER}].filter(function(t){return t})},[r]),o=(0,u.useCallback)(function(t,e){var n=t.key,g=t.domEvent;g.stopPropagation(),n===p.REFRESH?m(e.routePath):n===p.CLOSE?b(e.routePath):n===p.CLOSEOTHER&&a(e.routePath)},[a,b,m]),E=(0,u.useCallback)(function(t){return(0,C.jsx)(O.Z,{menu:{items:s,onClick:function(n){return o(n,t)}},trigger:["contextMenu"],children:(0,C.jsxs)("div",{style:{margin:"-12px 0",padding:"12px 0"},children:[t.icon,t.title]})})},[s]),k=(0,u.useMemo)(function(){return r.map(function(t){return{key:t.routePath,label:E(t),children:(0,C.jsx)("div",{children:t.children},t.key),closable:r.length>1}})},[r]),P=(0,u.useCallback)(function(t){var e=r.find(function(n){return n.routePath===t});e&&T.history.push(e==null?void 0:e.pathname)},[r]),c=function(e,n){n==="remove"&&b(e)},i=(0,u.useMemo)(function(){return{closeTab:b,closeOtherTab:a,refreshTab:m,onHidden:S,onShow:h}},[b,a,m,S,h]);return(0,C.jsx)(D.Provider,{value:i,children:(0,C.jsx)(H.Z,{type:"editable-card",items:k,activeKey:f,onChange:P,className:"keep-alive-tabs",hideAdd:!0,animated:!1,onEdit:c})})},F=w}}]);
